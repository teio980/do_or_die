<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test - Procrastination Knowledge Quiz</title>
<link rel="icon" href="../../images/logo.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = { darkMode: 'class' }
</script>

<script>
  if (localStorage.getItem("theme") === "dark") {
    document.documentElement.classList.add("dark");
  }
</script>

<script src="../../js/questions.js"></script>

<style>
    body, * {
      font-family: 'Poppins', sans-serif;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body {
        overflow-y: scroll;
        background-color: #F5F5F7;
    }

    .dark body {
      background-color: #121212;
      color: #EAEAEA;
    }

    .container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px 40px;
        background: #ffffff;
        border-radius: 14px;
        box-shadow: 0 3px 20px rgba(0,0,0,0.06);
        transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }

    .dark .container {
      background: rgba(30,30,30,0.85);
      color: #EAEAEA;
      box-shadow: 0 4px 30px rgba(0,0,0,0.5);
    }

    h1 {
        font-size: 28px;
        font-weight: 600;
        color: #3c55e6;
        margin-bottom: 10px;
        transition: color 0.3s ease;
    }

    .dark h1 {
        color: #818cf8;
    }

    .user-welcome {
        font-size: 16px;
        color: #666;
        margin-bottom: 15px;
        font-weight: 500;
    }

    .dark .user-welcome {
        color: #aaa;
    }

    .warning {
        background: #fff3cd;
        border-left: 5px solid #ffc107;
        padding: 15px 20px;
        margin: 20px 0;
        border-radius: 8px;
        color: #856404;
        transition: background 0.3s ease, color 0.3s ease;
    }

    .dark .warning {
        background: rgba(255, 193, 7, 0.2);
        color: #ffd54f;
        border-left-color: #ffb300;
    }

    .start-section {
        text-align: center;
        padding: 40px 20px;
    }

    .start-section p {
        transition: color 0.3s ease;
    }

    .dark .start-section p {
        color: #ccc;
    }

    .start-btn {
        padding: 18px 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .dark .start-btn {
        background: linear-gradient(135deg, #4c5fd5 0%, #5d3a82 100%);
    }

    .start-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .quiz-section {
        display: none;
    }

    .question-card {
        background: #f8f9ff;
        padding: 30px;
        border-radius: 12px;
        margin: 25px 0;
        border-left: 5px solid #3c55e6;
        transition: background 0.3s ease, border-color 0.3s ease;
    }

    .dark .question-card {
        background: rgba(60, 60, 80, 0.3);
        border-left-color: #818cf8;
    }

    .question-number {
        font-size: 14px;
        color: #666;
        font-weight: 600;
        margin-bottom: 10px;
        transition: color 0.3s ease;
    }

    .dark .question-number {
        color: #aaa;
    }

    .question-text {
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 25px;
        line-height: 1.6;
        transition: color 0.3s ease;
    }

    .dark .question-text {
        color: #eee;
    }

    .options {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .option {
        padding: 18px 20px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.3s;
        font-weight: 500;
    }

    .dark .option {
        background: rgba(50, 50, 50, 0.8);
        border-color: #555;
        color: #ddd;
    }

    .option:hover {
        border-color: #3c55e6;
        background: #f0f4ff;
    }

    .dark .option:hover {
        border-color: #818cf8;
        background: rgba(129, 140, 248, 0.2);
    }

    .option.selected {
        border-color: #3c55e6;
        background: #e8efff;
    }

    .dark .option.selected {
        border-color: #818cf8;
        background: rgba(129, 140, 248, 0.3);
    }

    .option.correct {
        border-color: #4caf50;
        background: #e8f5e9;
        color: #2e7d32;
    }

    .dark .option.correct {
        border-color: #66bb6a;
        background: rgba(76, 175, 80, 0.3);
        color: #81c784;
    }

    .option.wrong {
        border-color: #f44336;
        background: #ffebee;
        color: #c62828;
    }

    .dark .option.wrong {
        border-color: #ef5350;
        background: rgba(244, 67, 54, 0.3);
        color: #e57373;
    }

    .option.disabled {
        cursor: not-allowed;
        opacity: 0.7;
    }

    .feedback {
        margin-top: 20px;
        padding: 15px 20px;
        border-radius: 10px;
        font-weight: 500;
        display: none;
    }

    .feedback.correct {
        background: #e8f5e9;
        color: #2e7d32;
        border-left: 5px solid #4caf50;
        display: block;
    }

    .dark .feedback.correct {
        background: rgba(76, 175, 80, 0.3);
        color: #81c784;
        border-left-color: #66bb6a;
    }

    .feedback.wrong {
        background: #ffebee;
        color: #c62828;
        border-left: 5px solid #f44336;
        display: block;
    }

    .dark .feedback.wrong {
        background: rgba(244, 67, 54, 0.3);
        color: #e57373;
        border-left-color: #ef5350;
    }

    .explanation {
        margin-top: 10px;
        padding: 10px 15px;
        background: rgba(255,255,255,0.5);
        border-radius: 8px;
        font-size: 14px;
        font-style: italic;
    }

    .dark .explanation {
        background: rgba(255,255,255,0.1);
    }

    .next-btn {
        margin-top: 25px;
        padding: 14px 40px;
        background: #3c55e6;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
        display: none;
    }

    .dark .next-btn {
        background: #4c5fd5;
    }

    .next-btn:hover {
        background: #2d3db8;
        transform: translateY(-2px);
    }

    .dark .next-btn:hover {
        background: #3d4eb0;
    }

    .result-section {
        display: none;
        text-align: center;
        padding: 40px 20px;
    }

    .result-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        border-radius: 14px;
        margin: 30px 0;
    }

    .dark .result-card {
        background: linear-gradient(135deg, #4c5fd5 0%, #5d3a82 100%);
    }

    .result-score {
        font-size: 64px;
        font-weight: 700;
        margin: 20px 0;
    }

    .result-message {
        font-size: 20px;
        margin: 15px 0;
    }

    .result-details {
        background: white;
        padding: 25px;
        border-radius: 12px;
        margin: 25px 0;
        color: #333;
        transition: background 0.3s ease, color 0.3s ease;
    }

    .dark .result-details {
        background: rgba(40, 40, 40, 0.9);
        color: #eee;
    }

    .result-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0;
        transition: border-color 0.3s ease;
    }

    .dark .result-row {
        border-bottom-color: #555;
    }

    .result-row:last-child {
        border-bottom: none;
    }

    .result-label {
        font-weight: 600;
        color: #666;
        transition: color 0.3s ease;
    }

    .dark .result-label {
        color: #aaa;
    }

    .result-value {
        font-weight: 600;
        color: #3c55e6;
        transition: color 0.3s ease;
    }

    .dark .result-value {
        color: #818cf8;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 30px;
    }

    .btn {
        padding: 14px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
    }

    .btn-primary {
        background: #3c55e6;
        color: white;
    }

    .dark .btn-primary {
        background: #4c5fd5;
    }

    .btn-primary:hover {
        background: #2d3db8;
        transform: translateY(-2px);
    }

    .dark .btn-primary:hover {
        background: #3d4eb0;
    }

    .btn-secondary {
        background: #f0f0f0;
        color: #333;
    }

    .dark .btn-secondary {
        background: #444;
        color: #ddd;
    }

    .btn-secondary:hover {
        background: #e0e0e0;
        transform: translateY(-2px);
    }

    .dark .btn-secondary:hover {
        background: #555;
    }

    .history-section {
        margin-top: 40px;
        padding: 25px;
        background: #f8f9ff;
        border-radius: 12px;
        transition: background 0.3s ease;
    }

    .dark .history-section {
        background: rgba(60, 60, 80, 0.3);
    }

    .history-title {
        font-size: 20px;
        font-weight: 600;
        color: #3c55e6;
        margin-bottom: 20px;
        transition: color 0.3s ease;
    }

    .dark .history-title {
        color: #818cf8;
    }

    .history-item {
        background: white;
        padding: 15px 20px;
        border-radius: 8px;
        margin: 10px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.3s ease;
    }

    .dark .history-item {
        background: rgba(50, 50, 50, 0.8);
    }

    .history-date {
        font-size: 14px;
        color: #666;
        transition: color 0.3s ease;
    }

    .dark .history-date {
        color: #aaa;
    }

    .history-username {
        font-size: 14px;
        color: #3c55e6;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .dark .history-username {
        color: #818cf8;
    }

    .history-score {
        font-size: 18px;
        font-weight: 600;
        color: #3c55e6;
        transition: color 0.3s ease;
    }

    .dark .history-score {
        color: #818cf8;
    }
</style>
</head>

<body class="bg-[#F5F5F7] dark:bg-[#121212] text-gray-900 dark:text-gray-100">
<!-- Navigation Bar -->
<nav class="fixed top-0 left-0 right-0 z-50 bg-white dark:bg-[#1A1A1A] border-b border-gray-200 dark:border-gray-700">
  <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
    <div class="text-xl font-extrabold tracking-wide bg-gradient-to-r from-indigo-500 to-purple-500 
                bg-clip-text text-transparent transition duration-300 transform hover:scale-105 hover:from-pink-500 hover:to-yellow-500">
      Do or Cry
    </div>
    <div class="flex items-center space-x-6">
      <a href="../home/home.html" class="font-medium transition duration-300 bg-gradient-to-r from-gray-800 to-gray-800 bg-clip-text text-transparent 
                dark:from-gray-200 dark:to-gray-200 hover:from-indigo-500 hover:to-purple-500">Home</a>
      <a href="../dashboard/dashboard.html" class="font-medium transition duration-300 bg-gradient-to-r from-gray-800 to-gray-800 bg-clip-text text-transparent 
                dark:from-gray-200 dark:to-gray-200 hover:from-indigo-500 hover:to-purple-500">Dashboard</a>
      <a href="../tools/tools.html" class="font-medium transition duration-300 bg-gradient-to-r from-gray-800 to-gray-800 bg-clip-text text-transparent 
                dark:from-gray-200 dark:to-gray-200 hover:from-indigo-500 hover:to-purple-500">Tools</a>
      <button onclick="toggleTheme()" class="p-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-500
               text-white dark:text-black transition duration-500 transform hover:scale-125 hover:rotate-180 hover:shadow-[0_0_12px_rgba(139,92,246,0.6)]">
        <span class="dark:hidden">üåô</span>
        <span class="hidden dark:inline">‚òÄÔ∏è</span>
      </button>
    </div>
  </div>
</nav>

<div class="h-16"></div>

<script>
  function toggleTheme() {
    const html = document.documentElement;
    const isDark = html.classList.toggle('dark');
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }
</script>

<div class="container">
    <h1>üìù Procrastination Knowledge Quiz</h1>
    <div class="user-welcome" id="userWelcome"></div>

    <!-- Start Section -->
    <div class="start-section" id="startSection">
        <p style="font-size: 18px; color: #666; margin: 20px 0;">Test your understanding of procrastination and time management</p>
        <p style="font-size: 16px; color: #999; margin-bottom: 30px;">10 random questions from our 30-question bank</p>
        <button class="start-btn" onclick="startQuiz()">Start Quiz</button>
    </div>

    <!-- Quiz Section -->
    <div class="quiz-section" id="quizSection">
        <div class="question-card" id="questionCard">
            <div class="question-number" id="questionNumber"></div>
            <div class="question-text" id="questionText"></div>
            <div class="options" id="optionsContainer"></div>
            <div class="feedback" id="feedback"></div>
            <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>

    <!-- Result Section -->
    <div class="result-section" id="resultSection">
        <div class="result-card">
            <h2 style="font-size: 24px; margin-bottom: 10px;">Quiz Complete!</h2>
            <div class="result-score" id="resultScore"></div>
            <div class="result-message" id="resultMessage"></div>
        </div>

        <div class="result-details">
            <div class="result-row">
                <span class="result-label">Total Questions:</span>
                <span class="result-value" id="totalQuestions"></span>
            </div>
            <div class="result-row">
                <span class="result-label">Correct:</span>
                <span class="result-value" style="color: #4caf50;" id="correctCount"></span>
            </div>
            <div class="result-row">
                <span class="result-label">Wrong:</span>
                <span class="result-value" style="color: #f44336;" id="wrongCount"></span>
            </div>
            <div class="result-row">
                <span class="result-label">Accuracy:</span>
                <span class="result-value" id="accuracy"></span>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="startQuiz()">Retake Quiz</button>
            <button class="btn btn-secondary" onclick="navigateTo('../home/home.html')">Back to Home</button>
        </div>

        <!-- History Section -->
        <div class="history-section" id="historySection">
            <div class="history-title">üìä Quiz History</div>
            <div id="historyList"></div>
        </div>
    </div>
</div>

<script>
// Global variables
let currentQuestion = 0;
let score = 0;
let answers = [];
let currentQuestions = [];
let currentUsername = '';

window.onload = function() {
    // Check if questionBank is loaded
    if (typeof questionBank === 'undefined') {
        alert('Error: Question bank not loaded! Please make sure questions.js is in the same directory.');
        return;
    }
    
    // Get username from localStorage
    currentUsername = localStorage.getItem('username') || 'Guest';
    document.getElementById('userWelcome').textContent = `Welcome back, ${currentUsername}! üëã`;
};

// Shuffle array function (Fisher-Yates algorithm)
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Get random questions from the bank
function getRandomQuestions(count) {
    const shuffled = shuffleArray(questionBank);
    return shuffled.slice(0, Math.min(count, questionBank.length));
}

// Shuffle options for a question and track correct answer
function shuffleOptions(question) {
    const indices = [0, 1, 2, 3];
    const shuffledIndices = shuffleArray(indices);
    
    const shuffledOptions = shuffledIndices.map(i => question.options[i]);
    const newCorrectIndex = shuffledIndices.indexOf(question.correct);
    
    return {
        question: question.question,
        options: shuffledOptions,
        correct: newCorrectIndex,
        explanation: question.explanation,
        originalCorrectAnswer: question.options[question.correct]
    };
}

function startQuiz() {
    currentQuestion = 0;
    score = 0;
    answers = [];
    
    // Get 10 random questions and shuffle their options
    const randomQuestions = getRandomQuestions(10);
    currentQuestions = randomQuestions.map(q => shuffleOptions(q));
    
    document.getElementById('startSection').style.display = 'none';
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('quizSection').style.display = 'block';
    
    showQuestion();
}

function showQuestion() {
    const q = currentQuestions[currentQuestion];
    
    document.getElementById('questionNumber').textContent = `Question ${currentQuestion + 1} / ${currentQuestions.length}`;
    document.getElementById('questionText').textContent = q.question;
    
    const optionsContainer = document.getElementById('optionsContainer');
    optionsContainer.innerHTML = '';
    
    q.options.forEach((option, index) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = option;
        div.onclick = () => selectAnswer(index);
        optionsContainer.appendChild(div);
    });
    
    document.getElementById('feedback').style.display = 'none';
    document.getElementById('feedback').className = 'feedback';
    document.getElementById('nextBtn').style.display = 'none';
}

function selectAnswer(index) {
    const q = currentQuestions[currentQuestion];
    const options = document.querySelectorAll('.option');
    
    // Disable all options
    options.forEach(opt => {
        opt.classList.add('disabled');
        opt.onclick = null;
    });
    
    // Mark correct answer
    options[q.correct].classList.add('correct');
    
    const isCorrect = index === q.correct;
    const feedback = document.getElementById('feedback');
    
    if (isCorrect) {
        score++;
        feedback.className = 'feedback correct';
        feedback.innerHTML = `
            ‚úÖ Correct! Well done!
            <div class="explanation">üí° ${q.explanation}</div>
        `;
    } else {
        options[index].classList.add('wrong');
        feedback.className = 'feedback wrong';
        feedback.innerHTML = `
            ‚ùå Incorrect! The correct answer is: ${q.options[q.correct]}
            <div class="explanation">üí° ${q.explanation}</div>
        `;
    }
    
    answers.push({
        question: q.question,
        selected: index,
        correct: q.correct,
        isCorrect: isCorrect
    });
    
    document.getElementById('nextBtn').style.display = 'block';
}

function nextQuestion() {
    currentQuestion++;
    
    if (currentQuestion < currentQuestions.length) {
        showQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    document.getElementById('quizSection').style.display = 'none';
    document.getElementById('resultSection').style.display = 'block';
    
    const percentage = Math.round((score / currentQuestions.length) * 100);
    
    document.getElementById('resultScore').textContent = percentage + '%';
    document.getElementById('totalQuestions').textContent = currentQuestions.length;
    document.getElementById('correctCount').textContent = score;
    document.getElementById('wrongCount').textContent = currentQuestions.length - score;
    document.getElementById('accuracy').textContent = percentage + '%';
    
    let message = '';
    if (percentage >= 90) {
        message = 'üéâ Excellent! You have mastered procrastination knowledge!';
    } else if (percentage >= 70) {
        message = 'üëç Good job! Keep it up!';
    } else if (percentage >= 60) {
        message = 'üòä You passed! There\'s room for improvement!';
    } else {
        message = 'üí™ Keep trying! We recommend reviewing the learning content!';
    }
    
    document.getElementById('resultMessage').textContent = message;
    
    saveScore(percentage);
    displayHistory();
}

function saveScore(percentage) {
    const history = JSON.parse(localStorage.getItem('testHistory') || '[]');
    
    const newRecord = {
        username: currentUsername,
        date: new Date().toLocaleString('en-US'),
        score: percentage,
        correct: score,
        total: currentQuestions.length
    };
    
    history.unshift(newRecord);
    
    // Keep only last 100 records
    if (history.length > 100) {
        history.pop();
    }
    
    localStorage.setItem('testHistory', JSON.stringify(history));
}

function displayHistory() {
    const history = JSON.parse(localStorage.getItem('testHistory') || '[]');
    const historyList = document.getElementById('historyList');
    
    if (history.length === 0) {
        historyList.innerHTML = '<p style="text-align: center; color: #999;">No quiz history yet</p>';
        return;
    }
    
    historyList.innerHTML = '';
    history.forEach(record => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
            <div>
                <div class="history-username">${record.username || 'Guest'}</div>
                <div class="history-date">${record.date}</div>
                <div style="font-size: 14px; color: #666; margin-top: 4px;">
                    ${record.correct}/${record.total} correct
                </div>
            </div>
            <div class="history-score">${record.score}%</div>
        `;
        historyList.appendChild(div);
    });
}

function navigateTo(page) {
    window.location.href = page;
}
</script>
</body>
</html>